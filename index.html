<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Manuel Raynaud" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body>
<h1 id="introduction">Introduction</h1>
<p>Thelia is an open source tool for creating e-business websites and managing online content. Created in 2005, The new version of Thelia aims to be the next generation E-commerce system. It is based on Symfony 2 components and meets the following objectives : performance and scalability. #Installation</p>
<h2 id="requirements">Requirements</h2>
<p>Thelia needs at least php 5.4 and works with php 5.5 and 5.6 for now. For the database, Thelia requires at least mysql 5.5.</p>
<h2 id="php-extensions">PHP extensions</h2>
<ul>
<li>intl</li>
<li>mcrypt</li>
<li>mysql and pdo_mysql</li>
<li>curl</li>
<li>gd</li>
</ul>
<h2 id="download-thelia">Download Thelia</h2>
<p>You can download Thelia in two different ways</p>
<h3 id="from-the-thelia-website">From the Thelia website</h3>
<p>Go to the thelia website (http://thelia.net) and download it.</p>
<h3 id="using-composer">Using Composer</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">curl</span> -sS https://getcomposer.org/installer <span class="kw">|</span> <span class="kw">php</span>
$ <span class="kw">php</span> composer.phar create-project thelia/thelia your-path 2.0.3</code></pre>
<h2 id="install-thelia">Install Thelia</h2>
<p>First of all, create a vhost dedicated to Thelia and put the documentRoot in the web directory.</p>
<p>Here again you can install Thelia in two different ways</p>
<h3 id="using-install-wizard">Using install wizard</h3>
<p>with your favorite browser, navigate to the install directory :</p>
<p>http://yourdomain.tld/[/subdomain_if_needed]/install</p>
<p>For example, I have thelia downloaded at http://thelia.net and my vhost is correctly configured, I have to go to this address :</p>
<p>http://thelia.net/install</p>
<h3 id="using-cli-tools">Using cli tools</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">php</span> Thelia thelia:install</code></pre>
<p>and follow the instructions</p>
<p><strong>After installing Thelia, remove the web/install directory</strong></p>
<h1 id="thelias-structure">Thelia's structure</h1>
<p>After the installation you have an architecture like this</p>
<pre><code>www &lt;- your web root directory
    thelia &lt;- your thelia directory
        bin
        cache
        core
        setup
        local
            config
            modules
            session
        log
        templates
        web &lt;- the only directory accessible by your web server</code></pre>
<h2 id="local-directory">Local directory</h2>
<p>in this directory you can find four directories :</p>
<ul>
<li>config : contains the database.yml file. In this file is stored the information for connecting to the database.</li>
<li>modules : contains the modules developed by yourself or the community</li>
<li>media : contains the media uploaded from the back-office. For example you can find all the product pictures.</li>
<li>session : by default Thelia stores the sessions in this directory. You can change the directory where the sessions are saved. To do this insert a new record in the config table with <code>session_config.save_path</code> for the column name and in the value column put the full path where you want to store the sessions.</li>
</ul>
<h2 id="template-directory">Template directory</h2>
<p>The template directory contains all the templates for all Thelia's environment : front-office, back-office, email and pdf. For each type of templates a directory exists and contains as many template as you want but only one can be enabled (in the back-office panel -&gt; Configuration -&gt; System variables)</p>
<p>A good practice is to duplicate the default template and then modify to have a custom template. The default front-office template is highly customizable, see some example at <a href="https://github.com/thelia-templates">https://github.com/thelia-templates</a></p>
<h2 id="web-directory">Web directory</h2>
<p>The web directory is the only one accessible by your web server. It contains by default two controllers :</p>
<ul>
<li>index.php : used in production environement, it calculate the cache only once and never tries to know if it is outdated or not so after each modification <strong>don't forget to clear the cache</strong></li>
<li>index_dev.php : used when you develop the store. This controller is more flexible, the cache is checked all the time and refreshed if needed. It also logs a lot of information, like every request you make, all assets creation, etc.</li>
</ul>
<h2 id="other-directories">Other directories</h2>
<p>The other directories are less important :</p>
<ul>
<li>bin : propel and phpunit binaries are in this directory</li>
<li>cache : the cache for each environment so you find a dev, prod and even test directory if you run test. Each environment has its own cache so if you clear the cache for the dev environment, only the dev environment will be affect.</li>
<li>core : Thelia's source code and third party dependencies managed with composer.</li>
<li>setup : all the files needed for bootstraping thelia : sql database, fake catalog script, etc</li>
<li>logs : Thelia's logs. The configuration is in the admin panel (configuration -&gt; System logs)</li>
</ul>
<h1 id="cli-tools">CLI Tools</h1>
<p>Thelia has a command line tools that can help you automate repetitive task . Obviously you can develop your own command.</p>
<h2 id="usage">Usage</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> to/thelia/repository
$ <span class="kw">php</span> Thelia</code></pre>
<p>If you use the command line without any argument, it will display all command and options available.</p>
<p>List of available commands :</p>
<table>
<thead>
<tr class="header">
<th align="left"><strong>command</strong></th>
<th align="left"><strong>description</strong></th>
<th align="left"><strong>example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">admin:create</td>
<td align="left">Create a new administrator user</td>
<td align="left"><code>$ php Thelia admin:create</code></td>
</tr>
<tr class="even">
<td align="left">admin:updatePassword</td>
<td align="left">Change administrator password</td>
<td align="left"><code>$ php Thelia admin:updatePassword adminlogin [--pasword=&quot;...&quot;]</code></td>
</tr>
<tr class="odd">
<td align="left">cache:clear</td>
<td align="left">Invalidate cache</td>
<td align="left"><code>$ php Thelia cache:clear [--env=&quot;...&quot;] [--without-assets] [--with-images]</code></td>
</tr>
<tr class="even">
<td align="left">image-cache:clear</td>
<td align="left">Empty part or whole web space image cache</td>
<td align="left"><code>$ php Thelia  image-cache:clear [subdir]</code></td>
</tr>
<tr class="odd">
<td align="left">module:activate</td>
<td align="left">Activate a module</td>
<td align="left"><code>$ php Thelia module:activate module-name</code></td>
</tr>
<tr class="even">
<td align="left">module:deactivate</td>
<td align="left">Deactivate a module</td>
<td align="left"><code>$ php Thelia module:deactivate module-name</code></td>
</tr>
<tr class="odd">
<td align="left">module:generate</td>
<td align="left">Generate all needed files for creating a new Module</td>
<td align="left"><code>$ php Thelia module:generate module-name</code></td>
</tr>
<tr class="even">
<td align="left">module:generate:model</td>
<td align="left">Generate model for a specific module</td>
<td align="left"><code>$ php Thelia module:generate:module module-name [--generate-sql]</code></td>
</tr>
<tr class="odd">
<td align="left">module:generate:sql</td>
<td align="left">Generate the sql from schema.xml file for a specific module</td>
<td align="left"><code>$ php Thelia module:generate:sql module-name</code></td>
</tr>
<tr class="even">
<td align="left">module:refresh</td>
<td align="left">Refresh module list</td>
<td align="left"><code>$ php Thelia module:refresh</code></td>
</tr>
<tr class="odd">
<td align="left">thelia:dev:reloadDB</td>
<td align="left">Erase current database and create new one. <strong>all your data will be lost</strong></td>
<td align="left"><code>$ php Thelia thelia:dev:reloadDB</code></td>
</tr>
<tr class="even">
<td align="left">thelia:generate-resources</td>
<td align="left">Outputs admin resources</td>
<td align="left"><code>$ php Thelia thelia:generate-resources [--output[=&quot;...&quot;]]</code></td>
</tr>
<tr class="odd">
<td align="left">thelia:install</td>
<td align="left">Install Thelia</td>
<td align="left"><code>$ php Thelia thelia:install</code></td>
</tr>
<tr class="even">
<td align="left">thelia:update</td>
<td align="left">Update Thelia database. Before doing that you have to update Thelia files</td>
<td align="left"><code>$ php Thelia thelia:update</code></td>
</tr>
</tbody>
</table>
<h1 id="modules">Modules</h1>
<p>Modules are the best way to extend Thelia functionalities. Payment and delivery methods are all modules.</p>
<p>A module has the exact same structure as Thelia's core and can interact with the container for adding its own services, creating new compilers, etc.</p>
<h2 id="structure">Structure</h2>
<pre><code>\MyModule
    \Config
        config.xml   &lt;- mandatory
        module.xml   &lt;- mandatory
        routing.xml
        schema.xml
    MyModule.php &lt;- mandatory
    \Loop
        Product.php
        MyLoop.php
    ...</code></pre>
<h3 id="config.xml-content">Config.xml content</h3>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; <span class="kw">?&gt;</span>

<span class="kw">&lt;config</span><span class="ot"> xmlns=</span><span class="st">&quot;http://thelia.net/schema/dic/config&quot;</span>
<span class="ot">        xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="ot">        xsi:schemaLocation=</span><span class="st">&quot;http://thelia.net/schema/dic/config http://thelia.net/schema/dic/config/thelia-1.0.xsd&quot;</span><span class="kw">&gt;</span>

        <span class="kw">&lt;loops&gt;</span>
            <span class="kw">&lt;loop</span><span class="ot"> name=</span><span class="st">&quot;MySuperLoop&quot;</span><span class="ot"> class=</span><span class="st">&quot;MyModule\Loop\MySuperLoop&quot;</span> <span class="kw">/&gt;</span>
        <span class="kw">&lt;/loops&gt;</span>

        <span class="kw">&lt;forms&gt;</span>
            <span class="kw">&lt;form</span><span class="ot"> name=</span><span class="st">&quot;MyFormName&quot;</span><span class="ot"> class=</span><span class="st">&quot;MyModule\Form\MySuperForm&quot;</span> <span class="kw">/&gt;</span>
        <span class="kw">&lt;/forms&gt;</span>

        <span class="kw">&lt;commands&gt;</span>
            <span class="kw">&lt;command</span><span class="ot"> class=</span><span class="st">&quot;MyModule\Command\MySuperCommand&quot;</span> <span class="kw">/&gt;</span>
        <span class="kw">&lt;/commands&gt;</span>

        <span class="kw">&lt;services&gt;</span>
            <span class="kw">&lt;service</span><span class="ot"> id=</span><span class="st">&quot;Mymodule.service.id&quot;</span><span class="ot"> class=</span><span class="st">&quot;MyModule\MySuperService&quot;</span><span class="kw">/&gt;</span>
        <span class="kw">&lt;/services&gt;</span>
        --&gt;

        <span class="kw">&lt;hooks&gt;</span>
            <span class="kw">&lt;hook</span><span class="ot"> id=</span><span class="st">&quot;mymodule.hook&quot;</span><span class="ot"> class=</span><span class="st">&quot;MyModule\Hook\MySuperHook&quot;</span><span class="ot"> scope=</span><span class="st">&quot;request&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;tag</span><span class="ot"> name=</span><span class="st">&quot;hook.event_listener&quot;</span><span class="ot"> event=</span><span class="st">&quot;main.body.bottom&quot;</span><span class="ot"> type=</span><span class="st">&quot;front|back|pdf|email&quot;</span><span class="ot"> method=</span><span class="st">&quot;onMainBodyBottom&quot;</span> <span class="kw">/&gt;</span>
            <span class="kw">&lt;/hook&gt;</span>
        <span class="kw">&lt;/hooks&gt;</span>

        <span class="kw">&lt;exports&gt;</span> <span class="kw">&lt;/exports&gt;</span>

        <span class="kw">&lt;imports&gt;</span> <span class="kw">&lt;/imports&gt;</span>

<span class="kw">&lt;/config&gt;</span></code></pre>
<table>
<col width="10%" />
<col width="89%" />
<thead>
<tr class="header">
<th align="left">Tag</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>loop</p></td>
<td align="left"><p>declare a loop. name and class properties are mandatories. The name is a unique key and class the full namespace for the loop class.</p></td>
</tr>
<tr class="even">
<td align="left"><p>form</p></td>
<td align="left"><p>declare a form. name and class properties are mandatories. The name is a unique key and class the full namespace for the form class.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>command</p></td>
<td align="left"><p>declare a command. name property is mandatory. The class is the full namespace for the command class.</p></td>
</tr>
<tr class="even">
<td align="left"><p>service</p></td>
<td align="left"><p>Services are the exact same notion as symfony services. See de dedicated chapter below</p></td>
</tr>
<tr class="odd">
<td align="left"><p>hook</p></td>
<td align="left"><p>Hooks are entry point in your template in which the modules will insert their own code. For configuring a hook, you must declare them in the config.xml file. Example :</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;hook</span><span class="ot"> id=</span><span class="st">&quot;mymodule.hook&quot;</span><span class="ot"> class=</span><span class="st">&quot;MyModule\Hook\MySuperHook&quot;</span><span class="ot"> scope=</span><span class="st">&quot;request&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;tag</span><span class="ot"> name=</span><span class="st">&quot;hook.event_listener&quot;</span><span class="ot"> event=</span><span class="st">&quot;main.body.bottom&quot;</span><span class="ot"> type=</span><span class="st">&quot;front&quot;</span><span class="ot"> method=</span><span class="st">&quot;onMainBodyBottom&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/hook&gt;</span></code></pre>
<p>On the hook node, id and class are mandatories. id is an unique identifier and class the full path to the class.</p>
<p>On the tag node, name and event are mandatories, the other are not and are explain just below :</p>
<ul>
<li><code>name=&quot;hook.event_listener&quot;</code> : this never change</li>
<li>event : represents the hook code for which it wants to respond.</li>
<li>type : indicate the context of the hook : frontOffice (default), backOffice, pdf or email.</li>
<li>method : indicate the method to be called. By default, it will be based on the name of the hook. eg : for product.additional hook, the method onProductAdditional will be called (CamelCase prefixed by on).</li>
<li>active : allow you to activate the hook (set to 1 - default) or not (set to 0) when the module is installed</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>export</p></td>
<td align="left"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;export</span><span class="ot"> id=</span><span class="st">&quot;your.export.id&quot;</span><span class="ot"> class=</span><span class="st">&quot;Your\ExportHandler&quot;</span><span class="ot"> category_id=</span><span class="st">&quot;the.category_id&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;en_US&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;title&gt;</span>Your export title <span class="kw">&lt;/title&gt;</span>
      <span class="co">&lt;!-- you may add an optionnal description --&gt;</span>
      <span class="kw">&lt;description&gt;</span> ... <span class="kw">&lt;/description&gt;</span>
  <span class="kw">&lt;/descriptive&gt;</span>
  <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;fr_FR&quot;</span><span class="kw">&gt;</span>
      <span class="co">&lt;!-- Here&#39;s for another locale --&gt;</span>
  <span class="kw">&lt;/descriptive&gt;</span>
<span class="kw">&lt;/export&gt;</span></code></pre>
<p>On the export node, id, class and category_id properties are mandatories. id is an unique identifier and class the full path to the class.</p>
<p>category_id possible values are :</p>
<ul>
<li>thelia.export.customer : Exports concerning customers</li>
<li>thelia.export.products : Exports concerning products</li>
<li>thelia.export.content : Exports concerning contents</li>
<li>thelia.export.order : Exports concerning orders</li>
<li>thelia.export.modules : module related exports</li>
</ul>
<p>You can also create a custom category if you want. For this you have to put something like below :</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;export_categories&gt;</span>
    <span class="kw">&lt;export_category</span><span class="ot"> id=</span><span class="st">&quot;your.category.id&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;title</span><span class="ot"> locale=</span><span class="st">&quot;en_US&quot;</span><span class="kw">&gt;</span>A title<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;title</span><span class="ot"> locale=</span><span class="st">&quot;fr_FR&quot;</span><span class="kw">&gt;</span>Un titre<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;/export_category&gt;</span>
    <span class="kw">&lt;export_category</span><span class="ot"> id=</span><span class="st">&quot;your.other.category.id&quot;</span><span class="kw">&gt;</span>
        <span class="co">&lt;!-- here&#39;s another import category --&gt;</span>
    <span class="kw">&lt;/export_category&gt;</span>
<span class="kw">&lt;/export_categories&gt;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><p>import</p></td>
<td align="left"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;import</span><span class="ot"> id=</span><span class="st">&quot;your.import.id&quot;</span><span class="ot"> class=</span><span class="st">&quot;Your\ImportHandler&quot;</span><span class="ot"> category_id=</span><span class="st">&quot;the.category_id&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;en_US&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;title&gt;</span>Your import title <span class="kw">&lt;/title&gt;</span>
         <span class="co">&lt;!-- you may add an optionnal description --&gt;</span>
         <span class="kw">&lt;description&gt;</span> ... <span class="kw">&lt;/description&gt;</span>
    <span class="kw">&lt;/descriptive&gt;</span>
    <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;fr_FR&quot;</span><span class="kw">&gt;</span>
        <span class="co">&lt;!-- Here&#39;s for another locale --&gt;</span>
    <span class="kw">&lt;/descriptive&gt;</span>
<span class="kw">&lt;/import&gt;</span></code></pre>
<p>On the import node, id, class and category_id properties are mandatories. id is an unique identifier and class the full path to the class.</p>
<p>category_id possible values are :</p>
<ul>
<li>thelia.import.customer : Imports concerning customers</li>
<li>thelia.import.products : Imports concerning products</li>
<li>thelia.import.content : Imports concerning contents</li>
<li>thelia.import.order : Imports concerning orders</li>
<li>thelia.import.modules : module related imports</li>
</ul></td>
</tr>
</tbody>
</table>
<h3 id="module.xml-content">Module.xml content</h3>
<p>Module.xml file is a description of your module. It contains who is the author and how to contact him, module version and with which version of Thelia it works.</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;<span class="kw">?&gt;</span>
<span class="kw">&lt;module&gt;</span>
    <span class="kw">&lt;fullnamespace&gt;</span>Atos\Atos<span class="kw">&lt;/fullnamespace&gt;</span>
    <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;en_US&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;title&gt;</span>Atos-sips payment module<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;/descriptive&gt;</span>
    <span class="kw">&lt;descriptive</span><span class="ot"> locale=</span><span class="st">&quot;fr_FR&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;title&gt;</span>module de paiement Atos-sips<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;/descriptive&gt;</span>
    <span class="kw">&lt;version&gt;</span>0.9<span class="kw">&lt;/version&gt;</span>
    <span class="kw">&lt;author&gt;</span>
        <span class="kw">&lt;name&gt;</span>Manuel Raynaud<span class="kw">&lt;/name&gt;</span>
        <span class="kw">&lt;email&gt;</span>manu@thelia.net<span class="kw">&lt;/email&gt;</span>
    <span class="kw">&lt;/author&gt;</span>
    <span class="kw">&lt;type&gt;</span>payment<span class="kw">&lt;/type&gt;</span>
    <span class="kw">&lt;thelia&gt;</span>2.0.0<span class="kw">&lt;/thelia&gt;</span>
    <span class="kw">&lt;stability&gt;</span>beta<span class="kw">&lt;/stability&gt;</span>
<span class="kw">&lt;/module&gt;</span></code></pre>
<table>
<col width="13%" />
<col width="86%" />
<thead>
<tr class="header">
<th align="left">Tag</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>fullnamespace</p></td>
<td align="left"><p>The full namespace for the module's main class.</p></td>
</tr>
<tr class="even">
<td align="left"><p>descriptive</p></td>
<td align="left"><p>This block can be repeat for how many locales you want. It contains a title, subtitle, description and postscriptum. Only the title is mandatory.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>version</p></td>
<td align="left"><p>Module version</p></td>
</tr>
<tr class="even">
<td align="left"><p>author</p></td>
<td align="left"><p>Author information. It contains a name, a company, an email and a website tag. Only the name is mandatory</p></td>
</tr>
<tr class="odd">
<td align="left"><p>type</p></td>
<td align="left"><p>What type of your module. Can be one of the value below :</p>
<ul>
<li>payment : your module is a payment gateway.</li>
<li>delivery : your module is a delivery platform.</li>
<li>classic : all other types.</li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>thelia</p></td>
<td align="left"><p>Which version of Thelia your module is compatible for.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>stability</p></td>
<td align="left"><p>You module stability. Can be one of the value below :</p>
<ul>
<li>alpha</li>
<li>beta</li>
<li>rc</li>
<li>prod</li>
<li>other</li>
</ul></td>
</tr>
</tbody>
</table>
<h2 id="routing">Routing</h2>
<p>Thelia uses the symfony-cmf routing component, so it's possible to declare how many routers needed and add them in this routing component. If you need a router you can do it in two different ways</p>
<h3 id="the-default-behavior">The default behavior</h3>
<p>All you have to do is to create a file named routing.xml in your Config directory. Thelia will configure a new router and set a default priority (150) to it.</p>
<h3 id="custom-routing">Custom routing</h3>
<p>If you need a custom configuration for your routing, you can declare a new service and tag this service and put <code>router.register</code> for the name property and the priority you want.</p>
<p>Here an example :</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;service</span><span class="ot"> id=</span><span class="st">&quot;router.front&quot;</span><span class="ot"> class=</span><span class="st">&quot;%router.class%&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;argument</span><span class="ot"> type=</span><span class="st">&quot;service&quot;</span><span class="ot"> id=</span><span class="st">&quot;router.module.xmlLoader&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;argument&gt;</span>Front/Config/front.xml<span class="kw">&lt;/argument&gt;</span>
    <span class="kw">&lt;argument</span><span class="ot"> type=</span><span class="st">&quot;collection&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;argument</span><span class="ot"> key=</span><span class="st">&quot;cache_dir&quot;</span><span class="kw">&gt;</span>%kernel.cache_dir%<span class="kw">&lt;/argument&gt;</span>
        <span class="kw">&lt;argument</span><span class="ot"> key=</span><span class="st">&quot;debug&quot;</span><span class="kw">&gt;</span>%kernel.debug%<span class="kw">&lt;/argument&gt;</span>
    <span class="kw">&lt;/argument&gt;</span>
    <span class="kw">&lt;argument</span><span class="ot"> type=</span><span class="st">&quot;service&quot;</span><span class="ot"> id=</span><span class="st">&quot;request.context&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;tag</span><span class="ot"> name=</span><span class="st">&quot;router.register&quot;</span><span class="ot"> priority=</span><span class="st">&quot;128&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;/service&gt;</span></code></pre>
<h2 id="model">Model</h2>
<p>Your module will maybe need to create tables, generate model classes and interact with Thelia's model.</p>
<ol style="list-style-type: decimal">
<li>Create the file schema.xml in your Config directory.</li>
<li>Fill schema.xml file, you can find all the information you need in the propel documentation.</li>
<li>Use the CLI tools for generating model and sql (<code>php Thelia module:generate:model MyModule --generate-sql</code>).</li>
</ol>
<p>Note : it's better to put the namespace property on each table attributes instead of the database attribute.</p>
<h2 id="main-class">Main class</h2>
<p>The main class in your module is the most important file. This class is used when the module is activated or deactivated.</p>
<p>Most of time this class will have the same name as you module directory. If my module directory is <strong>Atos</strong>, my main class will be <strong>Atos</strong> too and the full namespace will be <strong>Atos\Atos</strong>.</p>
<p>Depending of the type of your module, this class must extends a specific abstract class. Here is a list of all abstract classes :</p>
<ul>
<li><strong>Thelia\Module\AbstractDeliveryModule</strong> : Use this class when you develop a delivery module</li>
<li><strong>Thelia\Module\AbstractPaymentModule</strong> : Use this class when you develop a payment module</li>
<li><strong>Thelia\Module\BaseModule</strong> : Use this class when you develop a class module</li>
</ul>
<p><strong>AbstractDeliveryModule</strong> and <strong>AbstractPaymentModule</strong> classes extends BaseModule class.</p>
<p>Some methods in <strong>BaseModule</strong> can be useful if you want to interact with Thelia during installation or removal process. You just have to overload the method you want and implement your code.</p>
<table>
<col width="15%" />
<col width="84%" />
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>preActivation</p></td>
<td align="left"><p>This method is called before the module activation, and may prevent it by returning false.</p></td>
</tr>
<tr class="even">
<td align="left"><p>postActivation</p></td>
<td align="left"><p>This method is called just after the module was successfully activated. If an exception is thrown the procedure will be stopped and a rollback of the current transaction will be performed.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>preDeactivation</p></td>
<td align="left"><p>This method is called before the module de-activation, and may prevent it by returning false.</p></td>
</tr>
<tr class="even">
<td align="left"><p>postDeactivation</p></td>
<td align="left"><p>This method is called just after the module was successfully deactivated. If an exception is thrown the procedure will be stopped and a rollback of the current transaction will be performed.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>getCompilers</p></td>
<td align="left"><p>This method adds new compilers to Thelia container</p></td>
</tr>
<tr class="even">
<td align="left"><p>getHooks</p></td>
<td align="left"><p>This method must be used when your module defines hooks.</p></td>
</tr>
</tbody>
</table>
<p>Specific methods for <strong>AbstractDeliveryModule</strong></p>
<table>
<col width="15%" />
<col width="84%" />
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>isValidDelivery</p></td>
<td align="left"><p>This method is called by the Delivery loop, to check if the current module has to be displayed to the customer. This method must be implemented in your module</p></td>
</tr>
<tr class="even">
<td align="left"><p>getPostage</p></td>
<td align="left"><p>Calculate and return delivery price in the shop's default currency. This method must be implemented in your module</p></td>
</tr>
</tbody>
</table>
<p>Specific methods for <strong>AbstractPaymentModule</strong></p>
<table>
<col width="23%" />
<col width="76%" />
<thead>
<tr class="header">
<th align="left">Method</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>pay</p></td>
<td align="left"><p>Method used by payment gateway. This method must be implemented in your module</p></td>
</tr>
<tr class="even">
<td align="left"><p>isValidPayment</p></td>
<td align="left"><p>This method is call on Payment loop, to check if the current module has to be displayed to the customer. This method must be implemented in your module</p></td>
</tr>
<tr class="odd">
<td align="left"><p>generateGatewayFormResponse</p></td>
<td align="left"><p>Render the payment gateway template. The module should provide the gateway URL and the form fields names and values. This method is a helper</p></td>
</tr>
<tr class="even">
<td align="left"><p>getPaymentSuccessPageUrl</p></td>
<td align="left"><p>Return the order payment success page URL</p></td>
</tr>
<tr class="odd">
<td align="left"><p>getPaymentFailurePageUrl</p></td>
<td align="left"><p>Redirect the customer to the failure payment page. if $message is null, a generic message is displayed.</p></td>
</tr>
</tbody>
</table>
<h1 id="templating">Templating</h1>
<p>Thelia templates uses the Smarty template engine, enriched by many Thelia additions, such as loops, data access functions, internationalization function, etc</p>
<h2 id="structure-1">Structure</h2>
<p>See Thelia structure for more information.</p>
<p>Every template should contains specific template files, which are the views invoked in the Front and Back Offices controllers. For a front-office template, these files are :</p>
<ul>
<li><strong>product.html</strong> : display a product.</li>
<li><strong>content.html</strong> : display a contents.</li>
<li><strong>category.html</strong> : displays a category contents.</li>
<li><strong>feed.html</strong> : the RSS product or content feed.</li>
<li><strong>folder.html</strong> : display a folder contents.</li>
<li><strong>404.html</strong> : displayed if a page cannot be found.</li>
<li><strong>order-delivery.html</strong> : display for choosing a delivery method.</li>
<li><strong>order-failed.html</strong> : display when a payment failed.</li>
<li><strong>order-invoice.html</strong> : display for choosing a payment gateway.</li>
<li><strong>order-payment-gateway.html</strong> : fill by the payment gateway for sending a specific form to the platform.</li>
<li><strong>order-placed.html</strong> : display for a success payment.</li>
</ul>
<h2 id="assets-management">Assets management</h2>
<p>Template assets are managed in a sub-directory of the template directory. For example, the default front-office template contains an 'assets' directory to store all template's assets.</p>
<p>To use this feature, you'll have to add some specific directives to your template files.</p>
<h3 id="declare_assets">{declare_assets}</h3>
<p>This directive tells the Thelia template system where your assets are located, e.g. the name of the root directory which contains all your assets.</p>
<p>Example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{declare_assets directory=<span class="st">&quot;assets&quot;</span>}</code></pre>
<h3 id="stylesheets">{stylesheets}</h3>
<p>This directive processes your CSS style sheets.</p>
<p>Example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{stylesheets file=<span class="st">&quot;assets/css/*.less&quot;</span> filters=<span class="st">&quot;less&quot;</span>}
    &lt;link href=<span class="st">&quot;{$asset_url}&quot;</span> rel=<span class="st">&quot;stylesheet&quot;</span> type=<span class="st">&quot;text/css&quot;</span> <span class="ot">/&gt;</span>
<span class="ot">{/stylesheets</span>}</code></pre>
<p>This block return only one parameter, $asset_url, which is the asset URL in the web space, e.g. under the web/assets path.</p>
<p>List of parameters</p>
<table>
<col width="23%" />
<col width="76%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>file</p></td>
<td align="left"><p>This is the path to the file (or files, as jokers like '*' are allowed), relative to the template base path.</p></td>
</tr>
<tr class="even">
<td align="left"><p>filters</p></td>
<td align="left"><p>Apply a filter to the source(s) files. Available filters are :</p>
<ul>
<li>less : compile CSS using the LESS compiler</li>
<li>sass : compile CSS using the SASS compiler</li>
<li>compass : compile CSS using the Compass compiler</li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p>source</p></td>
<td align="left"><p>When in the templates files of a module, use this parameter to specify that the source of the asset has to be searched within the module's path instead of the main template path.</p></td>
</tr>
<tr class="even">
<td align="left"><p>template</p></td>
<td align="left"><p>You may want to use an asset located in another template of the same type (for example, another front office template). To do so, specify the name of this template in the template parameter</p></td>
</tr>
</tbody>
</table>
<h3 id="images">{images}</h3>
<p>This directive process your statics images used in your template.</p>
<p>Example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{images file=<span class="st">&#39;assets/img/favicon.ico&#39;</span>}
    &lt;link rel=<span class="st">&quot;shortcut icon&quot;</span> type=<span class="st">&quot;image/x-icon&quot;</span> href=<span class="st">&quot;{$asset_url}&quot;</span>&gt;
{<span class="ot">/images}</span></code></pre>
<p>This block return only one parameter, $asset_url, which is the asset URL in the web space, e.g. under the web/assets path.</p>
<p>List of parameters</p>
<table>
<col width="23%" />
<col width="76%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>file</p></td>
<td align="left"><p>This is the path to the file (jokers like '*' are <strong>NOT</strong> allowed), relative to the template base path.</p></td>
</tr>
<tr class="even">
<td align="left"><p>source</p></td>
<td align="left"><p>When in the templates files of a module, use this parameter to specify that the source of the asset has to be searched within the module's path instead of the main template path.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>template</p></td>
<td align="left"><p>You may want to use an asset located in another template of the same type (for example, another front office template). To do so, specify the name of this template in the template parameter</p></td>
</tr>
</tbody>
</table>
<h3 id="javascripts">{javascripts}</h3>
<p>This directive process your javascript files</p>
<p>Example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{javascripts file=<span class="st">&#39;assets/js/script.js&#39;</span>}
    &lt;script type=<span class="st">&quot;text/javascript&quot;</span> src=<span class="st">&quot;{$asset_url}&quot;</span>&gt;&lt;<span class="ot">/script&gt;</span>
<span class="ot">{/javascripts</span>}</code></pre>
<p>List of parameters</p>
<table>
<col width="23%" />
<col width="76%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>file</p></td>
<td align="left"><p>This is the path to the file (or files, as jokers like '*' are allowed), relative to the template base path.</p></td>
</tr>
<tr class="even">
<td align="left"><p>source</p></td>
<td align="left"><p>When in the templates files of a module, use this parameter to specify that the source of the asset has to be searched within the module's path instead of the main template path.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>template</p></td>
<td align="left"><p>You may want to use an asset located in another template of the same type (for example, another front office template). To do so, specify the name of this template in the template parameter</p></td>
</tr>
</tbody>
</table>
<h2 id="internationalization">Internationalization</h2>
<p>If you want to create multilingual compatible templates, you have to pay a special attention to : - static text - date formatting - number formatting - money formatting</p>
<p>Thelia provides several Smarty functions to help you.</p>
<h3 id="intl">{intl}</h3>
<p>The {intl} function translates a string into the current language.</p>
<p>Example :</p>
<pre><code>{intl l=&quot;This is a string to translate&quot;}</code></pre>
<p>List of parameters</p>
<table>
<col width="10%" />
<col width="89%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>l</p></td>
<td align="left"><p>The l parameter contains the string that will be translated. This string should not contains any variable, such as {intl l=&quot;Hello, <span class="math">$name, how do you do ?&quot;}, internal variables should be used instead. Every %varname found in the string will be replaced by the value of the varname parameter. For example: {intl l=&quot;Hello, %user, how do you do ?&quot; user=$</span>name} is fine.</p>
<p>If no translation can be found for a given string, the translator will return either the value of the l parameter, or an empty string, depending on the &quot;Languages &amp; URLs&quot; parameters.</p></td>
</tr>
<tr class="even">
<td align="left"><p>d</p></td>
<td align="left"><p>The d parameter is the message domain, a set of internationalized messages. Thelia contains the following domains :</p>
<ul>
<li>core : for Thelia core translations</li>
<li>bo.<em>template_name</em> (eg : bo.default) : for each back-office template</li>
<li>fo.<em>template_name</em> (eg : fo.default) : for each front-office template</li>
<li>pdf.<em>template_name</em> (eg : pdf.default) : for each PDF template</li>
<li>email.<em>template_name</em> (eg : email.default) : for each email template</li>
<li>in modules :
<ul>
<li><em>module_code</em> (eg : paypal) : for module core translations</li>
<li><em>module_code</em>.ai (eg : paypal.ai) : used in AdminIncludes templates</li>
<li><em>module_code</em>.bo.<em>template_name</em> (eg : paypal.bo.default) : used in back office template</li>
<li><em>module_code</em>.fo.<em>template_name</em> (eg : paypal.fo.default) : used in front office template</li>
</ul></li>
</ul>
<p>This parameter is mostly used in modules. Other templates (front-office, back-office, PDF and email) may use the {default_translation_domain} function to define a template-wide message domain, and the d parameter could then be omitted.</p>
<p>For examples, in the layout.tpl file of the default front-office template, you'll find {default_translation_domain domain='fo.default'}.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>js</p></td>
<td align="left"><p>When using {intl} in a Javascript string, the translated string may contain simple and/or double quotes, that should be escaped to prevent a syntax error.</p>
<p>To do so, use the js parameter, that will escape single and double quotes.</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript"> <span class="kw">var</span> myString = <span class="st">&#39;{intl l=&quot;A string with &#39;</span>simple<span class="st">&#39; and </span><span class="ch">\&quot;</span><span class="st">double</span><span class="ch">\&quot;</span><span class="st"> quotes&quot; js=1}&#39;</span>;</code></pre></td>
</tr>
</tbody>
</table>
<h3 id="format_date">{format_date}</h3>
<p>Use this function to format a date according to the current locale standards.</p>
<p>example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">{format_date date=$dateTimeObject}</code></pre>
<p>List fo parameters</p>
<table>
<col width="10%" />
<col width="89%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>date</p></td>
<td align="left"><p>A DateTime object (required)</p></td>
</tr>
<tr class="even">
<td align="left"><p>format</p></td>
<td align="left"><p>The expected format. The current locale format will be used if this parameter is empty or missing</p></td>
</tr>
<tr class="odd">
<td align="left"><p>output</p></td>
<td align="left"><p>The type of desired ouput, one of :</p>
<ul>
<li>date : the date only</li>
<li>time : the time only</li>
<li>datetime : the date and the time (default)</li>
</ul></td>
</tr>
</tbody>
</table>
<h3 id="format_number">{format_number}</h3>
<p>Use this function to format a number according to the current locale standards, or a specific format.</p>
<p>Example :</p>
<pre class="sourceCode JavaScript"><code class="sourceCode javascript">Outputs <span class="st">&quot;1246,12&quot;</span> <span class="kw">if</span> locale is fr_FR, <span class="dv">1</span> <span class="fl">246.12</span> <span class="kw">if</span> locale is en_US
{format_number number=<span class="st">&quot;1246.12&quot;</span>}</code></pre>
<p>List fo parameters</p>
<table>
<col width="13%" />
<col width="86%" />
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>number</p></td>
<td align="left"><p>Int or float number. (Required)</p></td>
</tr>
<tr class="even">
<td align="left"><p>decimals</p></td>
<td align="left"><p>How many decimals format expected. If omitted, the current locale parameter is taken</p></td>
</tr>
<tr class="odd">
<td align="left"><p>dec_point</p></td>
<td align="left"><p>Separator for the decimal point. If omitted, the current locale parameter is taken</p></td>
</tr>
<tr class="even">
<td align="left"><p>thousands_sep</p></td>
<td align="left"><p>Thousands separator. If omitted, the current locale parameter is taken</p></td>
</tr>
</tbody>
</table>
</body>
</html>
